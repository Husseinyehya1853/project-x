{% extends 'base.html' %}

{% block title %}الإحصائيات العامة 1{% endblock %}

{% block extra_styles %}
    <style>
        /* تنسيق العنوان */
        h2 {
            color: #1B5E20;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: right;
        }

        /* تنسيق الفلاتر */
        .filters-container {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filters-container input {
            padding: 8px;
            border: 1px solid #e6f0e6;
            border-radius: 4px;
            font-size: 14px;
            color: #4A4A4A;
            background: #FFFFFF;
            direction: rtl;
            width: 200px;
        }

        .filters-container button {
            background: #1B5E20;
            color: #FFFFFF;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filters-container button:hover {
            background: #2e7d32;
        }

        .filters-container button i {
            font-size: 12px;
        }

        /* تنسيق بطاقات الإحصائيات */
        .stats-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .stats-card {
            background: #FFFFFF;
            border: 1px solid #e6f0e6;
            border-radius: 8px;
            padding: 20px;
            width: 200px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        .stats-card .number {
            font-size: 28px;
            font-weight: 700;
            color: #1B5E20;
            margin-bottom: 10px;
        }

        .stats-card .label {
            font-size: 14px;
            color: #4A4A4A;
        }

        /* تنسيق الرسم البياني */
        .chart-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 30px auto;
            direction: rtl;
            text-align: center;
        }

        .chart-container h3 {
            color: #1B5E20;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        /* تنسيق الجدول */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            direction: rtl;
        }

        .stats-table th,
        .stats-table td {
            padding: 12px 15px;
            text-align: right;
            font-size: 14px;
            color: #4A4A4A;
        }

        .stats-table th {
            background: #b1e3b5dc;
            color: #1B5E20;
            font-weight: 600;
            border-bottom: 2px solid #e6f0e6;
        }

        .stats-table td {
            background: #FFFFFF;
            border-bottom: 1px solid #e6f0e6;
        }

        .stats-table tr:hover td {
            background: #E6F0E6;
        }

        /* تنسيق الرسالة في حالة عدم وجود بيانات */
        .no-data {
            color: #4A4A4A;
            font-size: 16px;
            text-align: center;
            margin: 20px 0;
        }

        /* زر العودة */
        .back-btn-container {
            text-align: center;
            margin-top: 20px;
        }
    </style>
{% endblock %}

{% block content %}
    <h2>الإحصائيات العامة 1</h2>

    <!-- الفلاتر -->
    <div class="filters-container">
        <input type="date" id="startDate" onchange="filterStats()">
        <input type="date" id="endDate" onchange="filterStats()">
        <button onclick="filterStats()"><i class="fas fa-filter"></i> تصفية</button>
    </div>

    <!-- بطاقات الإحصائيات -->
    <div class="stats-cards">
        <div class="stats-card">
            <div class="number" id="totalJobs">25</div>
            <div class="label">إجمالي الوظائف</div>
        </div>
        <div class="stats-card">
            <div class="number" id="leadershipJobs">15</div>
            <div class="label">وظائف قيادية</div>
        </div>
        <div class="stats-card">
            <div class="number" id="supervisoryJobs">10</div>
            <div class="label">وظائف إشرافية</div>
        </div>
        <div class="stats-card">
            <div class="number" id="completedJobs">20</div>
            <div class="label">وظائف منجزة</div>
        </div>
    </div>

    <!-- الرسم البياني -->
    <div class="chart-container">
        <h3>توزيع الوظائف القيادية والإشرافية</h3>
        <canvas id="jobsChart"></canvas>
    </div>

    <!-- جدول تفاصيل الإحصائيات -->
    <table class="stats-table" id="statsTable">
        <thead>
            <tr>
                <th>نوع الوظيفة</th>
                <th>عدد الوظائف</th>
                <th>عدد الوظائف المنجزة</th>
                <th>عدد الوظائف تحت الإجراء</th>
                <th>تاريخ آخر تحديث</th>
            </tr>
        </thead>
        <tbody>
            <!-- بيانات تجريبية -->
            <tr>
                <td>وظائف قيادية</td>
                <td>15</td>
                <td>12</td>
                <td>3</td>
                <td>2025-04-25</td>
            </tr>
            <tr>
                <td>وظائف إشرافية</td>
                <td>10</td>
                <td>8</td>
                <td>2</td>
                <td>2025-04-25</td>
            </tr>
        </tbody>
    </table>

    <!-- رسالة في حالة عدم وجود بيانات -->
    <p class="no-data" id="noDataMessage" style="display: none;">لا توجد بيانات تطابق معايير التصفية.</p>

{% endblock %}

{% block extra_scripts %}
    <!-- إضافة مكتبة Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // إعداد الرسم البياني عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('jobsChart').getContext('2d');
            const jobsChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['وظائف قيادية', 'وظائف إشرافية'],
                    datasets: [{
                        data: [15, 10], // البيانات الأولية من الجدول
                        backgroundColor: ['#6a9262', '#b1e3b5dc'],
                        borderColor: ['#FFFFFF', '#FFFFFF'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    family: "'Arial', sans-serif"
                                },
                                color: '#4A4A4A'
                            }
                        },
                        tooltip: {
                            bodyFont: {
                                size: 14,
                                family: "'Arial', sans-serif"
                            },
                            callbacks: {
                                label: function (context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw + ' وظيفة';
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // تحديث الرسم البياني عند التصفية
            window.jobsChart = jobsChart; // جعل الرسم البياني متاحًا عالميًا للتحديث
        });

        // دالة التصفية
        function filterStats() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const rows = document.querySelectorAll('#statsTable tbody tr');
            const noDataMessage = document.getElementById('noDataMessage');
            let hasVisibleRows = false;

            // تصفية الجدول
            rows.forEach(row => {
                const rowDate = row.cells[4].textContent;
                const matchesDate = (!startDate || rowDate >= startDate) && (!endDate || rowDate <= endDate);

                if (matchesDate) {
                    row.style.display = '';
                    hasVisibleRows = true;
                } else {
                    row.style.display = 'none';
                }
            });

            noDataMessage.style.display = hasVisibleRows ? 'none' : 'block';

            // تحديث أرقام البطاقات والرسم البياني بناءً على التصفية
            let totalJobs = 0, leadershipJobs = 0, supervisoryJobs = 0, completedJobs = 0;
            rows.forEach(row => {
                if (row.style.display !== 'none') {
                    const jobType = row.cells[0].textContent;
                    const total = parseInt(row.cells[1].textContent);
                    const completed = parseInt(row.cells[2].textContent);

                    totalJobs += total;
                    completedJobs += completed;
                    if (jobType.includes('قيادية')) {
                        leadershipJobs += total;
                    } else if (jobType.includes('إشرافية')) {
                        supervisoryJobs += total;
                    }
                }
            });

            // تحديث البطاقات
            document.getElementById('totalJobs').textContent = totalJobs;
            document.getElementById('leadershipJobs').textContent = leadershipJobs;
            document.getElementById('supervisoryJobs').textContent = supervisoryJobs;
            document.getElementById('completedJobs').textContent = completedJobs;

            // تحديث الرسم البياني
            window.jobsChart.data.datasets[0].data = [leadershipJobs, supervisoryJobs];
            window.jobsChart.update();
        }
    </script>
{% endblock %}